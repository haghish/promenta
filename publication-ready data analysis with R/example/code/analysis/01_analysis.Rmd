---
title: "Analysis"
author: "E. F. Haghish"
date: "2/27/2021"
output: html_document
---

Analysis
--------

There is no need for the entire analysis to be written in Rmd files. You can 
write R script files and source them within the dynamic document. Below, I 
source a function that I have written to extract the values of a CFA output 
from the `lavaan` package. By doing so, you can keep your dynamic documents 
clean and down to point. 

```{r}
source("../FUNCTIONS/getLavaanCFA.R")
```

The R code above is printed in the document, but as we are trying to keep 
the MS Word document clean, we can exclude the R code and output from the 
document using variety of options:

```{r, echo=FALSE, results='markup'}
col1 = c("`echo=FALSE`","`results=hide`","`include=FALSE`")
col2 = c("exclude the R code but keep its output",
         "keep R code but hide the results",
         "hide both R code and outputs")
strMat = cbind(col1, col2)
colnames(strMat) = c("__Option__", "__Description__") #use markdown syntax to style the table
pander(strMat, justify=c("left","left"))
```


### CFA analysis 

Including a figure in the document is automatic. Although, you can also 
export it as a PNG file and import it in the document. At top of the __MAIN__ 
file, I have increased the DPI resolution of the figures generated by R 
to make them ready for print. Here is an example of a path diagram for the 
CFA model. 

```{r, include=FALSE}
HS.model <- ' visual  =~ x1 + x2 + x3 
              textual =~ x4 + x5 + x6
              speed   =~ x7 + x8 + x9 '
fit <- cfa(HS.model, data=df)
summary(fit, fit.measures=TRUE)
```


```{r, echo=FALSE}
semPaths(fit,title=FALSE, style = "lisrel")
```


More importantly, once we run the factor analysis, we can extract the values and use them to 
construct a dynamic table or point them out in the dynamic text. Below, 
I extract the values and generate a dynamic table with them. Such a table 
is usually useful when comparing multiple models together: 

```{r, echo=FALSE}
# Here I extract the values of the CFA model and create a table with them. 
# 
results = getLavaanCFA(fit)
names(results) = "Estimates"
results[1,] = round(as.numeric(results[1,]), 2)
results[2,] = as.integer(results[2,])
results[1,] = paste0(results[1,], " (",results[2,],")")
results     = results[c(1,6,7,4,5,9,3),]
results = t(results)
colnames(results) = c("$\\chi ^{2}$ (df)", "RMSEA","RMSEA 95% CI","CFI",
                      "TLI","SRMR","P-value")
```

_Table X_: Estimates of the CFA model 
```{r, echo=FALSE}
pander(results)
```

Alternatively, you can use the extracted values in a dynamic text and refer 
to the one by one. For example, the RMSEA value was estimated to be 
`r results[2]`... Note that I also included a mathematical notation in the table 
for $\chi ^{2}$. 
